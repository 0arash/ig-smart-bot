// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ChatMessageType {
  TEXT
}

enum Action {
  AdminRequired
  ProductRequest
}

enum Role {
  USER
  ADMIN
}

enum InvoiceStatus {
  VERIFIED
  UNVERIFIED
  CANCELLED
  PENDING
}

model User {
  id              Int               @id @default(autoincrement())
  email           String            @unique
  password        String
  name            String?
  token           String?
  address         String?
  code_meli       String?
  role            Role              @default(USER)
  user_plans      UserPlan[]
  Invoice         Invoice[]
  LeechedProducts LeechedProducts[]
}

model Plan {
  id         Int        @id @default(autoincrement())
  title      String
  price      Int
  days       Int
  user_plans UserPlan[]
  invoices   Invoice[]
}

model UserPlan {
  id               Int               @id @default(autoincrement())
  plan             Plan              @relation(fields: [plan_id], references: [id])
  user             User              @relation(fields: [user_id], references: [id])
  plan_id          Int               @map("planId")
  user_id          Int               @map("userId")
  chat_users       ChatUser[]
  created_at       DateTime          @default(now())
  products         Product[]
  api_key          String?           @unique
  business_title   String?
  business_caption String?
  LeechedProducts  LeechedProducts[]
}

model ChatUser {
  id            Int           @id @default(autoincrement())
  name          String?
  email         String?
  user_plan     UserPlan      @relation(fields: [user_plan_id], references: [id])
  user_plan_id  Int           @map("userPlanId")
  created_at    DateTime      @default(now())
  chat_messages ChatMessage[]
}

model ChatMessage {
  id              Int             @id @default(autoincrement())
  type            ChatMessageType @default(TEXT)
  content         String
  is_user_message Boolean         @default(true)
  chat_user       ChatUser?       @relation(fields: [chat_user_id], references: [id])
  chat_user_id    Int             @map("chatUserId")
  action_req      Action?
  created_at      DateTime        @default(now())
}

model Product {
  id           Int        @id @default(autoincrement())
  url          String
  title        String
  description  String
  image        String
  price        Int
  status       Boolean    @default(true)
  attributes   Json
  user_plan    UserPlan   @relation(fields: [user_plan_id], references: [id])
  user_plan_id Int        @map("userPlanId")
  weight       Float      @default(0)
  categories   Category[]
}

model Category {
  id       Int       @id @default(autoincrement())
  title    String
  products Product[]
}

model Invoice {
  id     Int           @id @default(autoincrement())
  user   User          @relation(fields: [userId], references: [id])
  userId Int
  plan   Plan          @relation(fields: [planId], references: [id])
  planId Int
  status InvoiceStatus @default(PENDING)
}

model LeechedProducts {
  id           Int       @id @default(autoincrement())
  url          String
  title        String
  price        Int
  category     String
  UserPlan     UserPlan? @relation(fields: [user_plan_id], references: [id])
  user_plan_id Int?      @map("UserPlanId")
  User         User?     @relation(fields: [userId], references: [id])
  userId       Int?
}
